# Learning Task Tracker (Django版)

このリポジトリは、**学習タスク管理アプリのPoC（概念実証）としてDjangoで開発したテンプレートベースのWebアプリケーション**です。

現在はDjangoでの学習を再開しており、基礎の理解を深めながら機能拡張を進めています。

---

## 🧭 Django版の位置づけ

- DjangoのMVC構成やCRUD処理の理解を深めることを目的に構築した学習用PoCです。  
- 現在のビュー構成は、**関数ベースビュー（FBV）を採用**しています。  
  → 初期実装ではクラスベースビュー（CBV）を利用していましたが、**PoC段階でのシンプルな構造と可読性の優先**を考慮し、FBVへリファクタリングしました。  
- 認証モデルにはDjangoの `AbstractUser` を継承した **カスタムユーザーモデル（CustomUser）を導入**。  
  → `settings.AUTH_USER_MODEL` 経由で全体のユーザー参照を抽象化し、拡張性に配慮した設計です。  
- 認証はメールアドレスをユーザー名として扱うカスタム認証フォーム（`CustomLoginForm`）を導入し、  
  メールアドレス＋パスワードによるログインが可能な状態になっています。  
- 将来的にはFastAPI版などモダンなAPI分離構成への展開も視野に入れていますが、まずはDjango版で基礎固めを優先しています。

---

## 🗂 テンプレート構成について

現在、Djangoアプリのテンプレートは各アプリの `templates` ディレクトリ内で、  
さらにアプリ名をサブディレクトリとして分ける形（例：`apps/lessons/templates/lessons/`）で管理しています。  

この構成によりテンプレートの命名衝突を避け、Djangoのテンプレートローダーの標準的な慣習に沿った運用を行っています。  
ビューからのテンプレート指定時には、`lessons/lesson_list.html` のようにアプリ名を含めたパスで指定しています。  

---

## 🧩 画面遷移とテンプレートの参照

教材（Material）やレッスン（Lesson）の一覧・詳細画面は、  
各テンプレートをサブディレクトリに分けて整理し、  
関数ベースビューから該当テンプレートを参照する形をとっています。  

これによりPoC段階でも構造が分かりやすく、今後の拡張やFastAPIなど別構成への展開もスムーズに進められます。

---

## 🔑 認証方式の柔軟化について

- `settings.py` の `AUTH_METHOD` 設定により、ログイン認証の方法を切り替え可能です。  
  設定値は以下のいずれかを指定します：  
  - `'email'`（デフォルト）: メールアドレスでのログイン認証  
  - `'username'`: ユーザー名（ニックネーム）でのログイン認証  
  - `'both'`: メールアドレスまたはユーザー名のいずれかでログイン認証  
- `apps.accounts.backends.FlexibleAuthBackend` をカスタム認証バックエンドとして導入し、上記切り替え機能を実現しています。  
- ログインフォーム（`CustomLoginForm`）は認証方式に応じて入力欄のラベルやプレースホルダを動的に変更し、ユーザーにわかりやすいUIを提供します。  
- PoC段階での認証の柔軟性を高めるとともに、将来的な認証方式の拡張を容易にする設計となっています。  

---

## ✅ 現在の実装済み機能

- 学習タスクの一覧表示、登録、編集、削除（CRUD）  
- Djangoテンプレートを用いた基本的な画面表示  
- SQLiteによるシンプルなデータ永続化  
- Django管理画面の日本語カスタマイズ（モデル名・フィールド名・アプリ名）  
- 教材（Material）とレッスン（Lesson）の関連インライン編集  
- ログイン済ユーザーに対する画面制御（@login_required）  
- `CustomUser` モデルによる拡張可能なユーザー認証基盤（admin対応済）  
- メールアドレス＋パスワードによるログイン（ユーザー名ではなくメールでの認証）  
- **教材に紐づくレッスンの登録・表示機能**  
- **レッスン単位での学習進捗（Progress）登録機能**  
- **教材・レッスン・進捗画面間の遷移・連携が自然なUI設計**

---

## 📐 設計見直しと再構築ブランチについて

現在の `main` ブランチでは、Djangoによる学習タスク管理アプリのPoCとして、  
教材（Material）・レッスン（Lesson）・進捗（Progress）を中心とした基本構成を採用しています。

しかしながら、**教材内の構成（章・項目・小節など）を柔軟にネスト構造として表現するニーズ**が明確になってきたため、モデル構成の再設計を検討しています。

この目的のために、以下のブランチを作成し、新しい構成の設計・実装を段階的に進めています。

- ブランチ名：`feature/refactor-material-node`
- 設計変更の概要：
  - 教材（Material）に対して、階層構造を持つノード型モデル `MaterialNode` を導入予定
  - `MaterialNode` は自己参照によるネスト（ツリー構造）を可能とし、章・セクション・小項目などを柔軟に表現可能
  - Django ORMにより、`Material` を親とする `MaterialNode` 一覧（例：`material.nodes.all()`）へのアクセスが可能となる見込み

> このブランチはPoCとは別系統の再設計ブランチであり、mainブランチの構成を保持したまま、段階的に比較・評価を進めています。
> ※ただし、このMaterialNodeを用いたネストツリー構造の実装は想定以上に複雑化し、PoCとしての開発効率やメンテナンス性を考慮し、一旦管理画面側の複雑な制限や独自JSを廃止し、シンプルな構成へリセットして開発を進める方針に変更しました。  
> 今後はユーザー画面でのMaterialおよびMaterialNodeのシンプルな登録・編集機能の構築に注力します。

再設計にあたっては、モデルの凝集度や再利用性、Django ORMの特性を踏まえた拡張性のある構成を意識しています。  
設計変更に関する議論や検証結果はREADMEに随時反映し、透明性のある開発方針を維持します。

---

## 🔄 設計方針の見直しについて（フォーム統合・画面表示）

初期段階では用途ごとにフォーム（例：`login_form.py`, `signup_form.py`）を分離する方針で開発していました。これは責務を明確化し、保守性を高めることを意図した構成です。

しかし、実際にPoCを進める中で、次のような理由からフォーム統合や表示ロジックのシンプル化を行いました。

- **開発規模やフォーム数が限定的な段階では、分割によるメリットよりも煩雑さが目立つことが判明した**  
- **ユーザー認証関連のロジックを単一ファイルで一元管理したほうが、PoC段階では実装効率・可読性ともに優れていた**  
- **教材やレッスンのフォームも動的な条件分岐を最小限にし、画面の表示・遷移をシンプルに保つ設計へ修正**  
- **将来的な再分離や拡張も容易な構成（クラス定義ベース）であるため、現時点では必要最小限の設計に注力**

設計方針の変更はできる限り慎重に行い、後戻りの負荷が小さい段階で都度見直しをかけています。変更の理由や背景は本READMEに明記し、意思決定過程の透明性を重視しています。

---

## 🛠 今後の開発予定（Django版）

- Djangoフォーム（ModelForm）を使った入力処理の強化  
- 教材モデルに対して進捗管理の目安となる複数の項目（章・段階・マイルストーン等）を  
  選択肢（select）と自由記述（テキストエリア）の組み合わせで追加検討  
- ユーザー登録・ログイン認証機能の拡張（外部認証連携・再設定機能など）  
- テストコードの整備とCI/CDパイプラインの構築  
- 必要に応じてREST API化やフロントエンド分離構成の検討  
- 管理画面のさらなる拡張（CSVインポート/エクスポート・フィルタUI改善など）  
- MaterialNodeのネストツリー構造については、PoCの進行に合わせて一旦シンプルな階層構造管理へ戻し、管理画面の複雑な絞り込み・JS制御は廃止。  
- ユーザー画面からのMaterialおよびMaterialNode登録・編集機能の構築に集中し、段階的に拡張予定。

---

## 📚 開発環境

- Python 3.12.3  
- Django 5.2.4  
- SQLite（開発用DB）  

---

## 📝 補足・所感

本プロジェクトは、PythonとDjangoでのWebアプリケーション開発を再学習するためのPoCです。

Djangoのクラスベースビュー（CBV）も理解したうえで、現在は処理の見通しや構造を把握しやすいFBVで構成しています。  
また、Django管理画面の柔軟な拡張性を活かし、関連モデルのインライン編集や表示名の日本語化など、業務用途に近い形でPoCを進めています。

今回、ユーザーモデルを `AbstractUser` に基づいてカスタム実装し、認証機能の将来的な拡張（プロフィール情報追加や外部認証連携など）にも対応しやすい構成としました。  
また、フォーム構成の見直しと教材・レッスン画面のUI調整を通じて、開発フェーズに応じた最適化や意思決定プロセスの記録・反映を行っています。

---

## 📎 関連プロジェクト

- 🚀 [learning-task-tracker-fastapi](https://github.com/ShigeoYugawa/learning-task-tracker-fastapi) — API分離構成を目指すFastAPI版
